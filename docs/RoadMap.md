
## 1. Общий RoadMap 

### Этап 1. Подготовка инфраструктуры и каркас микросервисов

1. **Родительский Gradle-проект (AnimeHaven)**
    - Создать многомодульный проект.
    - Настроить родительский `build.gradle.kts`, `settings.gradle.kts`, определить общие плагины и зависимости.
    - При желании — завести Docker Compose (пока что с PostgreSQL).

2. **User Service** 
    - Подключить БД, Flyway/Liquibase для миграций.
    - Создать базовые CRUD-операции: `POST /users`, `GET /users/{id}`, `PUT /users/{id}`, `DELETE /users/{id}`.
    - Обеспечить сохранение данных в PostgreSQL.
    - Написать базовые тесты (unit + integration).

3. **Auth Service** (аутентификация/авторизация)
    - Решить, будем ли мы делать «всё в одном» (Auth + User) или оставлять Auth отдельным сервисом.
    - Если отдельный, то в Auth Service настроить Spring Security (JWT), Google OAuth2, выдачу/валидацию токенов.
    - Определить модель данных (таблички, если нужно хранить refresh-токены) или дергать User Service по REST.
    - Написать интеграционные тесты, проверить авторизацию.

4. **Anime Catalog Service**
    - Таблицы `anime`, `genres`, `anime_genres`.
    - CRUD + поиск/фильтр (GET /anime?genre=...&title=...).
    - Проверить, что всё работает через REST, написать тесты.

5. **API Gateway**
    - Сконфигурировать Spring Cloud Gateway (или другой вариант).
    - Настроить маршруты:
        - `/api/users/**` -> User Service
        - `/api/auth/**` -> Auth Service
        - `/api/anime/**` -> Anime Catalog
        - и т.д.
    - Настроить проверку JWT (или передать на Auth Service).

На этом этапе уже **есть** ядро: пользователи, аутентификация, аниме-каталог.

---

### Этап 2. Расширение функционала (Комментарии, рекомендации, профили)

1. **Comments / Reviews Service**
    - Таблица `comments` (поля: id, user_id, anime_id, text, rating, created_at).
    - CRUD эндпоинты: `POST /comments`, `GET /comments?animeId=...`, `DELETE /comments/{id}`, и т.д.
    - Интеграция:
        - Может быть нужна авторизация (проверять JWT), чтобы писать/удалять комментарии.
        - User Service (нужен, чтобы знать, есть ли пользователь).
        - Anime Catalog Service (убедиться, что аниме существует).

2. **Recommendations Service**
    - Пока пусть будет “топ популярных” по количеству комментариев или среднему рейтингу.
    - Если хочется «умные» рекомендации, можно сделать зачатки коллаборативной фильтрации (но это уже отдельная математика).
    - Может подписываться на события о новых комментариях (через Kafka/RabbitMQ) или просто периодически опрашивать Comments Service.

3. **User Profile / Favourites / Watchlist** (User Service Level Up)
    - Добавить поля в User Service (например, `favouriteAnimeIds` или отдельную таблицу `user_favourites`).
    - Эндпоинты для добавления в избранное, просмотра списка избранного.
    - Возможно, хранить «список аниме, которые пользователь смотрит», статус («просматриваю», «дропнул», «завершил» и т.д.).

---

### Этап 3. Фронтенд, UI, интеграция и полировка

1. **Фронтенд** (SPA или SSR)
    - Реализовать UI для регистрации/логина (через Google), просмотра каталога, просмотра/добавления комментариев, списка избранного и т.д.
    - Все API-запросы идут через Gateway.
    - Добавить аутентификацию (JWT в localStorage или cookie-сессии).

2. **Дополнительные сервисы** (если нужно)
    - Почтовые уведомления (например, при ответе на комментарий).
    - Социальные фичи (подписки на друзей, ленты активности).

3. **Observability**
    - Включить Spring Boot Actuator, Prometheus/Grafana (при желании).
    - Логи в ELK или Loki + Grafana.

4. **Производительность / кэш**
    - При необходимости добавить Redis кэш, чтобы быстрее отдавать популярные аниме/комментарии.

5. **CI/CD**
    - GitHub Actions / GitLab CI: сборка проекта, прогоны тестов, сборка Docker-образов, пуш в Registry.
    - Деплой (Docker Compose на сервере, Kubernetes, или что-то ещё).

Ниже я расскажу, как может выглядеть **дорожная карта (RoadMap)** по проекту в целом, а затем отдельно поясню, **зачем может понадобиться User Service** (помимо простого CRUD).

---

## 2. Пример детализации RoadMap cо сроками (условно)

1. **Спринт 1 (1-2 недели)**
   - Поднять корневой проект (AnimeHaven).
   - Настроить User Service:
      - CRUD для User, миграции Flyway, базовые тесты.
   - Локально проверить, что сервис работает (Postman / Swagger).

2. **Спринт 2 (2 недели)**
   - Auth Service: Spring Security, JWT, Google OAuth2.
   - Связать Auth Service и User Service (Auth проверяет токен, при OAuth2 registration создаёт запись в User Service).
   - Настроить Docker Compose (PostgreSQL + 2 сервиса), убедиться, что поднимается командой `docker-compose up`.

3. **Спринт 3 (2-3 недели)**
   - Anime Catalog Service + CRUD по аниме (таблицы, миграции).
   - Простейшие методы поиска/фильтра (по названию, жанрам).
   - API Gateway (настройка роутов, проверка JWT).

4. **Спринт 4 (2-3 недели)**
   - Comments/Reviews Service (добавление комментариев, оценок).
   - Интеграционные тесты (User + Auth + Anime + Comments).
   - Минимальный фронтенд (хотя бы базовые HTML-страницы или SPA-«заготовку»).

5. **Спринт 5 (2-3 недели)**
   - Recommendations Service (начальная логика: “топ популярного”).
   - Улучшение фронтенда (раздел «Мои списки» в User Service, лайки, избранное).
   - Небольшие задачи по рефакторингу, логированию, мониторингу (Actuator, Prometheus).

6. **Спринт 6 и дальше**
   - Дополнительные фичи, соц. функционал, уведомления, CI/CD, деплой на сервер/облако.

